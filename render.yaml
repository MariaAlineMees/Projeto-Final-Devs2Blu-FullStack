services:
  # 1. RabbitMQ
  - type: pserv
    name: rabbitmq
    plan: free
    image:
      url: rabbitmq:3-management-alpine

  # 2. Backend: Roteiro Service
  - type: web
    name: roteiro-service
    plan: free
    dockerfilePath: ./Back/roteiro-service/Dockerfile
    envVars:
      # A URL do banco de dados ser√° adicionada manualmente no painel do Render
      - key: SPRING_DATASOURCE_URL
        value: "COLE_A_URL_DO_BANCO_DE_DADOS_AQUI"
      - key: SPRING_RABBITMQ_HOST
        fromService:
          type: pserv
          name: rabbitmq
          property: host
    healthCheck:
      path: /actuator/health
      initialDelaySeconds: 60

  # 3. Backend: Email Service
  - type: worker
    name: email-service
    plan: free
    dockerfilePath: ./Back/email-service/Dockerfile
    envVars:
      - key: SPRING_RABBITMQ_HOST
        fromService:
          type: pserv
          name: rabbitmq
          property: host

  # 4. Frontend: Roteiro Front (com Nginx)
  - type: web
    name: roteiro-front
    plan: free
    dockerfilePath: ./Front/Dockerfile
    routes:
      - type: rewrite
        source: /api/:path*
        destination: /:path*
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: NGINX_BACKEND_URL
        fromService:
          type: web
          name: roteiro-service
          property: url
